unit tdgener;interfaceprocedure luotaulukko( tiedosto : Text ; loppu : Boolean );procedure luolomake;implementationconst Oliotaulukonkoko = 10;type TOliotietue = record       kello : Tkello;       kupla : Tkupla;       jakokulma : TJakok;       kokoomataulu : TOwnGrid;       jaannostaulu : TOwnGrid;       numerotaulu : TOwnGrid;       erillisluku : Tluku;       objektinro : integer;     end;     Toliotaulukko = array[1..Oliotaulukonkoko] of Toliotietue;var oliotaulukko : Toliotaulukko;    viimolio : integer;procedure alustaoliotaulukko;var i : integerbegin  for i:=1 to Oliotaulukonkoko do    with Oliotaulukko[i] do begin      kello := nil;      kupla := nil;      jakokulma := nil;      kokoomataulu := nil;      jaannostaulu := nil;      numerotaulu := nil;      erillisluku := nil;      objektinro := -1;    end;end;procedure tyhjaaoliotaulu;begin  for i:=1 to Oliotaulukonkoko do    with Oliotaulukko[i] do begin      if (kello=nil) then kello.free;      if (kupla=nil) then kupla.free;      if (jakokulma=nil) then jakokulma.free;      if (kokoomataulu=nil) then kokoomataulu.free;      if (jaannostaulu=nil) then jaannostaulu.free;      if (numerotaulu=nil) then numerotaulu.free;      if (erillisluku=nil) then erillisluku.free;    end;end;procedure haeobjektinrotaulukosta( objektinro : integer ;  var taulind : integer );var loytyi : Boolean;begin  taulind:=1;loytyi := false;  while not loytyi and (taulind<=viimolio) do    if Oliotaulukko[taulind].objektinro=objektinro then loytyi:=true else Inc(i);  if not loytyi then begin    Inc(viimolio);Oliotaulukko[viimolio].objektinro=objektinro;    taulind := viimolio;  end;end;procedure haesolut( tiedosto : Text; taulu : TOwnGrid;  var rivi : string; var ind : integer );var riviind : integer;    j : integer;begin  for riviind := 1 to taulu.RowAmount Do    readln(tiedosto,rivi);    ind := Pos('"',rivi);    Delete(rivi,1,ind);    ind := Pos('"'),rivi);    taulu.Cells[riviind,1] := Copy(rivi,1,ind-1);    Delete(rivi,1,ind);    for j:= 2 to taulu.ColAmount do begin      ind := Pos(',',rivi);      Delete(rivi,ind);      ind := Pos('"',rivi);      Delete(rivi,ind);      ind := Pos('"',rivi);      taulu.Cells[riviind,j] := Copy(rivi,1,ind-1);      Delete(rivi,1,ind);    end;  end;  readln(tiedosto,rivi);ind := 1;end;procedure uusikokoomataulu( var taulu : TOwnGrid );var viivanelio : TLineSquare;    viiva : TLine;begin  taulu := TOwnGrid.Create;  { oletusrivi- ja sarakemÉÉrÉ }  taulu.RowAmount := 5;taulu.ColAmount := 2;  { oletussarakeleveys ja -rivikorkeus }  asetasarakeleveys(taulu,115);  asetarivikorkeus(taulu,25);  { oletusviivankoko ja vÉri }  viiva.width := 2;viiva.visible := true;viiva.Color := clBlack;  { Kokoomataulun muodon luonti }  viivanelio.RightLine := viiva;  viivanelio.BottomLine := viiva  viiva.visible := false;  viivanelio.TopLine := viiva;  viivanelio.LeftLine := viiva;  taulu.Lines[1,1] := viivanelio;  viivanelio.RightLine := viiva;  viiva.Visible := true;  viivanelio.LeftLine := viiva;  taulu.Lines[1,2] := viivanelio;  viivanelio.RightLine := viiva;  viivanelio.TopLine := viiva;  viiva.Visible := false;  viivanelio.BottomLine := viiva;  viivanelio.LeftLine := viiva;  taulu.Lines[2,1] := viivanelio;  viivanelio.RightLine := viiva;  viiva.Visible := true;  viivanelio.LeftLine := viiva;  taulu.Lines[2,2] := viivanelio;  viiva.Visible := false;  viivanelio.TopLine := viiva;  for i:= 3 to 5 do begin    viivanelio.LeftLine := viiva;    viiva.Visible := true;    viivanelio.RightLine := viiva;    taulu.Lines[i,1] := viivanelio;    viivanelio.LeftLine := viiva;    viiva.Visible := false;    viivanelio.RightLine := viiva;    taulu.Lines[i,2] := viivanelio;  end;end;procedure uusinumerotaulu( var taulu : TOwnGrid ; riveja, sarakkeita : integer );var viivanelio : TLineSquare;    viiva : TLine;    i,j : integer;begin  taulu := TOwnGrid.Create;  { oletusrivi- ja sarakemÉÉrÉ }  taulu.RowAmount := riveja;taulu.ColAmount := sarakkeita;  { oletussarakeleveys ja -rivikorkeus }  asetasarakeleveys(taulu,50);  asetarivikorkeus(taulu,25);  { oletusviivankoko ja vÉri }  viiva.width := 2;viiva.visible := true;viiva.Color := clBlack;  { Kokoomataulun muodon luonti }  viivanelio.TopLine := viiva;  viivanelio.LeftLine := viiva;  viivanelio.BottomLine := viiva;  viivanelio.RightLine := viiva;  for i := 1 to 5 do    for j := 1 to 6 do      taulu.Lines[i,j] := viivanelio;end;procedure asetasarakeleveys( taulu : TOwnGrid; leveys : integer );var j : integer;begin  for j:= 1 to taulu.ColAmount do taulu.ColWidths[j] := leveys;end;procedure asetarivikorkeus( taulu : TOwnGrid; korkeus : integer );var i : integer;begin  for i:= 1 to taulu.RowAmount do taulu.RowHeights[i] := korkeus;end;procedure asetatekstikoko( taulu : TOwnGrid; koko : integer );begin  taulu.Font.Size := koko;end;function haeluku( rivi : string; alkuind : integer ) : integer;var i : integer;begin  i:=alkuind;  while ((rivi[i]<'0') or (rivi[i]>'9')) do Inc(i);  alkuind := i;  while ((rivi[i]>='0') and (rivi[i]<='9')) do Inc(i);  result := StrToInt(Copy(rivi,alkuind,i-alkuind));end;procedure muutakokoomataulu( tiedosto : Text ; var rivi : string;  objektinro : integer; var ind : integer);var taulind : integer;    luku,riviind : integer;begin  haeobjektinrotaulukosta( objektinro, taulind );  if (oliotaulukko[taulind].kokoomataulu=nil) then    uusikokoomataulu( oliotaulukko[taulind].kokoomataulu );  riviind := Pos(',solut',rivi);  if (riviind>0) then begin    ind := riviind+6;    haesolut( tiedosto,oliotaulukko[taulind].kokoomataulu,rivi,ind);  end;  riviind := Pos(',rivimÉÉra',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+10 );    if (luku>0) then oliotaulukko[taulind].kokoomataulu.RowAmount := luku;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',vasen',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+6 );    if (luku>0) then oliotaulukko[taulind].kokoomataulu.Left := luku;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',ylÉ',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+4 );    if (luku>0) then oliotaulukko[taulind].kokoomataulu.Top := luku;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',sarakeleveys',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+13 );    if (luku>0) then asetasarakeleveys(oliotaulukko[taulind].kokoomataulu,luku);    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',rivikorkeus',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+12 );    if (luku>0) then asetarivikorkeus(oliotaulukko[taulind].kokoomataulu,luku);    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',tekstikoko',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+12 );    if (luku>0) then asetatekstikoko(oliotaulukko[taulind].kokoomataulu,luku);    readln(tiedosto,rivi);ind := 1;  end;end;procedure muutanumerotaulu( tiedosto : Text ; var rivi : string;  objektinro : integer; var ind : integer);begin  haeobjektinrotaulukosta( objektinro, taulind );  if (oliotaulukko[taulind].kokoomataulu=nil) then    uusinumerotaulu( oliotaulukko[taulind].numerotaulu,5,6 );  riviind := Pos(',solut',rivi);  if (riviind>0) then begin    ind := riviind+6;    haesolut( tiedosto,oliotaulukko[taulind].numerotaulu,rivi,ind);  end;  riviind := Pos(',rivimÉÉra',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+10 );    if (luku>0) then oliotaulukko[taulind].numerotaulu.RowAmount := luku;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',vasen',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+6 );    if (luku>0) then oliotaulukko[taulind].numerotaulu.Left := luku;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',ylÉ',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+4 );    if (luku>0) then oliotaulukko[taulind].numerotaulu.Top := luku;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',sarakeleveys',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+13 );    if (luku>0) then asetasarakeleveys(oliotaulukko[taulind].numerotaulu,luku);    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',rivikorkeus',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+12 );    if (luku>0) then asetarivikorkeus(oliotaulukko[taulind].numerotaulu,luku);    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',tekstikoko',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+12 );    if (luku>0) then asetatekstikoko(oliotaulukko[taulind].numerotaulu,luku);    readln(tiedosto,rivi);ind := 1;  end;end;procedure muutajaannostaulu( tiedosto : Text ; var rivi : string;  objektinro : integer; var ind : integer);begin  haeobjektinrotaulukosta( objektinro, taulind );  if (oliotaulukko[taulind].jaannostaulu=nil) then    uusinumerotaulu( oliotaulukko[taulind].numerotaulu,1,8 );  riviind := Pos(',solut',rivi);  if (riviind>0) then begin    ind := riviind+6;    haesolut( tiedosto,oliotaulukko[taulind].jaannostaulu,rivi,ind);  end;  riviind := Pos(',rivimÉÉra',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+10 );    if (luku>0) then oliotaulukko[taulind].jaannostaulu.RowAmount := luku;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',vasen',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+6 );    if (luku>0) then oliotaulukko[taulind].jaannostaulu.Left := luku;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',ylÉ',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+4 );    if (luku>0) then oliotaulukko[taulind].jaannostaulu.Top := luku;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',sarakeleveys',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+13 );    if (luku>0) then asetasarakeleveys(oliotaulukko[taulind].jaannostaulu,luku);    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',rivikorkeus',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+12 );    if (luku>0) then asetarivikorkeus(oliotaulukko[taulind].jaannostaulu,luku);    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',tekstikoko',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+12 );    if (luku>0) then asetatekstikoko(oliotaulukko[taulind].jaannostaulu,luku);    readln(tiedosto,rivi);ind := 1;  end;end;procedure uusikello( kello: Tkello );begin  kello := Tkello.Create;  kello.Width := 257;kello.Height := 257;  kello.Left := 104;  kello.BorderWidth := 3;  kello.FillColor := clWhite; kello.LineColor := clBlack;  kello.PointerColor := clGreen; kello.BorderColor := clBlack;  kello.NumberDistance := -20;  kello.NumbersOn := true;kello.LinesOn := true;  kello.OnlyPointerDrawnWhenMoved := true;  kello.LineLength := 3; kello.LineDistance := -3;end;procedure muutakello( tiedosto : Text;  rivi : string; objektinro : integer; var ind : integer);begin  haeobjektinrotaulukosta( objektinro, taulind );  if (oliotaulukko[taulind].jaannostaulu=nil) then    uusikello( oliotaulukko[taulind].kello );  riviind := Pos(',vasen',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+6 );    if (luku>0) then oliotaulukko[taulind].kello.Left := luku;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',ylÉ',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+4 );    if (luku>0) then oliotaulukko[taulind].kello.Top := luku;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',osoitin',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+8 );    if (luku>0) then oliotaulukko[taulind].kello.PointerTime := luku;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',numerokoko',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+11 );    if (luku>0) then oliotaulukko[taulind].kello.Font.Size := luku;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',askelmÉÉrÉ',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+11 );    if (luku>0) then oliotaulukko[taulind].kello.PointerPlaceNumber := luku;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',lÉvistÉjÉ',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+10 );    if (luku>0) then begin      oliotaulukko[taulind].kello.Width := luku;      oliotaulukko[taulind].kello.Height := luku;    end;    readln(tiedosto,rivi);ind := 1;  end;end;procedure muutajakokulma( tiedosto : Text; rivi : string; objektinro : integer;  var ind : integer);beginend;procedure muutaerillisluku( tiedosto : Text; rivi: string; objektinro : integer;  var ind : integer);beginend;procedure uusiteksti( kupla : TKupla );begin  kupla := Tkupla.Create;  kupla.Font.Size := 18;kupla.Font.Color := clBlack;  kupla.Width := 473;kupla.height := 200;  kupla.TextBeginX := 20;kupla.TextBeginY := 20;  kupla.TextAreaWidth := 365; kupla.TextAreaHeight := 160;  kupla.TextOn := true;kupla.PictureOn := false;  kupla.Top := 0;kupla.left := 0;  kupla.FillOn := false;kupla.BrushOn := false;  kupla.BorderOn := false;  kupla.ColoredTextAreaOn := false;  kupla.LineCap := 5;end;procedure haeteksti( tiedosto : Text; kupla: Tkupla; rivimaara : integer );var i : integer;    rivi : string;begin  kupla.Text.Clear;  for i:=1 to rivimaara do begin    readln(tiedosto,rivi);    kupla.Text.Add(rivi);  end;end;procedure muutateksti( tiedosto : Text ;  var rivi : string;  objektinro : integer; var ind : integer);begin  haeobjektinrotaulukosta( objektinro, taulind );  if (oliotaulukko[taulind].kupla=nil) then    uusiteksti( oliotaulukko[taulind].kupla );  riviind := Pos(',vasen',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+6 );    if (luku>0) then oliotaulukko[taulind].kupla.Left := luku+20;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',ylÉ',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+4 );    if (luku>0) then oliotaulukko[taulind].kupla.Top := luku+20;    readln(tiedosto,rivi);ind := 1;  end;  riviind := Pos(',teksti',rivi);  if (riviind>0) then begin    luku := haeluku( rivi, riviind+7 );    readln(tiedosto,rivi);ind := 1;    if (luku>0) then haeteksti(tiedosto,kupla,luku)  end;end;procedure toteutatyyppi( tiedosto : Text; var rivi : string; objektityyppi,objektinro : integer; var ind : integer );begin  case objektityyppi of    1 : muutakokoomataulu( tiedosto, rivi, objektinro, ind );    2 : muutanumerotaulu( tiedosto, rivi, objektinro, ind );    3 : muutajaannostaulu( tiedosto, rivi, objektinro, ind );    4 : muutakello( tiedosto, rivi, objektinro, ind );    5 : muutajakokulma( tiedosto, rivi, objektinro, ind );    6 : muutaerillisluku( tiedosto, rivi, objektinro, ind );    7 : muutateksti( tiedosto, rivi, objektinro, ind );  end;end;function haeobjektinro(rivi: string; var ind : integer ) : integer;var eiole : Boolean;begin  result := 0;eiole := true;  while (rivi[ind]>='0') and (rivi[ind]<='9') do begin    result := 10*result+rivi[ind]-'0';    eiole := false;    Inc(ind);  end;  if eiole then result := 1;end;procedure tunnistaobjekti(rivi : string;  var objektityyppi,objektinro,ind : integer );begin ind := Pos('Kokoomataulu',rivi); if (ind>0) then begin   objektityyppi := 1;ind := ind+12;   objektinro := haeobjektinro(rivi,ind); end; ind := Pos('Numerotaulu',rivi); if (ind>0) then begin   objektityyppi := 2;ind := ind+11;   objektinro := haeobjektinro(rivi,ind); end; ind := Pos('Jaannostaulu',rivi); if (ind>0) then begin   objektityyppi := 3;ind := ind+12;   objektinro := haeobjektinro(rivi,ind); end; ind := Pos('Kello',rivi); if (ind>0) then begin   objektityyppi := 4;ind := ind+5;   objektinro := haeobjektinro(rivi,ind); end; ind := Pos('Jakokulma',rivi); if (ind>0) then begin   objektityyppi := 5;ind := ind+9;   objektinro := haeobjektinro(rivi,ind); end; ind := Pos('Erillisluku',rivi); if (ind>0) then begin   objektityyppi := 6;ind := ind+11;   objektinro := haeobjektinro(rivi,ind); end; ind := Pos('Teksti',rivi); if (ind>0) then begin   objektityyppi := 7;ind := ind+6;   objektinro := haeobjektinro(rivi,ind); end;end;procedure luolomake( numero : integer );var tiedosto : Text;    tdnimi,rivi : string;    objektityyppi,objektinro,ind : integer;begin  tdnimi := 'lomake'+IntToStr(numero)+'.dat';  AssignFile(tiedosto,tdnimi);  Reset(tiedosto);  ReadLn(tiedosto,rivi);  tunnistaobjekti(rivi,objektityyppi,objektinro,ind);  toteutatyyppi( tiedosto,rivi,objektityyppi,objektinro,ind);  CloseFile(tiedosto);end;end.