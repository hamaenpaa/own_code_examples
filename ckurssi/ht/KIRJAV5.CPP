#include<iostream.h>#include<fstream.h>#include<stdio.h>#include<stdlib.h>#include<string.h>#include<ctype.h>#include<conio.h>#include "mjonot.h"#include "help.h"#include "apuohj.h"#include "jaejakst.h"/***********************************************************************/// Kirjojen tulostus n³yttäänstruct kirja {  char tdnimi[13];  char lyhenne[13];  char taydnimi[80];} kirjaalkio;struct kirja kirjat[67];void lue_kirjat(){  ifstream fi("c:\\oma\\ht\\kirjat.txt");  if (!fi)    { cout << "Tiedostoa ei läytynyt!!!!!!!" << endl;return; }  int kirja;  char lukujamj[4];  for(kirja=1;kirja<=66;kirja++){   fi.getline(kirjat[kirja].tdnimi,13);   fi.getline(kirjat[kirja].lyhenne,13);   fi.getline(kirjat[kirja].taydnimi,80);   fi.getline(lukujamj,4);  }}void tulosta_kirjat(){  int kirja,rivi,sarake;  textbackground(5);  textcolor(7);  clrscr();  gotoxy(15,3);  cprintf(" RAAMATUN KIRJAT JÚRJESTYSNUMEROINEEN :");  for(kirja=1;kirja<=66;kirja++) {    rivi = ((kirja-1) % 11)+5; // % jakoj³³nnäs: kirjan jakoj³³nnäs jaettuna 11.    sarake = ((kirja-1) / 11)*13+1; //  kokonaislukujen jakolasku:			      // tulos pyäristet³³n aina pienemp³³n.    gotoxy(sarake,rivi);    cprintf("%3d %-5s",kirja,kirjat[kirja].lyhenne);  }}/***********************************************************************/// Jaejakson tulostusvoid tulosta_kirjat_eri_jaejakso(int alkukirja,int alkuluku,int alkujae,  int loppukirja,int loppuluku,int loppujae){  cprintf("%s %d:%d-%s:%d:%d",kirjat[alkukirja].lyhenne,alkuluku,alkujae,	   kirjat[loppukirja].lyhenne,loppuluku,loppujae);}void tulosta_jaejakso_sama_kirja(int kirja, int alkuluku, int alkujae,     int loppuluku, int loppujae){  cprintf("%s %d:%d-%d:%d",    kirjat[kirja].lyhenne,alkuluku,alkujae,loppuluku,loppujae);};void tulosta_jaejakso_sama_luku( int kirja, int luku, int alkujae,  int loppujae){  cprintf("%s %d:%d-%d", kirjat[kirja].lyhenne,luku,alkujae,loppujae);}void tulosta_jaejakso_sama_jae( int kirja, int luku, int jae){  cprintf("%s %d:%d",kirjat[kirja].lyhenne,luku,jae);}void tulosta_jaejakso(int alkukirja,int alkuluku,int alkujae,  int loppukirja,int loppuluku,int loppujae){  if (alkukirja!=loppukirja)    tulosta_kirjat_eri_jaejakso(alkukirja,alkuluku,alkujae,      loppukirja,loppuluku,loppujae);  else if (alkuluku!=loppuluku) {    tulosta_jaejakso_sama_kirja(alkukirja,alkuluku,alkujae,      loppuluku,loppujae);  } else if (alkujae!=loppujae) {    tulosta_jaejakso_sama_luku(alkukirja,alkuluku,alkujae,loppujae);  } else tulosta_jaejakso_sama_jae(alkukirja,alkuluku,alkujae);}/*********************************************************************/// Jaejakson oikeellisuustarkistuksiaint jaejakso_oikeellisuus(int alkukirja,int alkuluku,int alkujae,			  int loppukirja,int loppuluku,int loppujae,			  int virhenro ){ if((alkukirja>loppukirja)||((alkukirja==loppukirja)&&(alkuluku>loppuluku))     ||((alkukirja==loppukirja)&&(alkuluku==loppuluku)&&(alkujae>loppujae))     ||(alkukirja==0)||(alkuluku==0)||(alkujae==0)||(loppukirja==0)     ||(loppuluku==0)||(loppujae==0) || (virhenro) )	 { gotoxy(10,16); textcolor(14); textbackground(5);	   if (virhenro==0)	     cprintf("VIRHEELLINEN JAEJAKSO !!! (Paina v³lilyänti)");	   if (virhenro<0)	     cprintf("SYúTTEESSÚSI OLI MUITAKIN KUIN NUMEROITA!");	   if (virhenro>0)	     cprintf("SINULLA EI OLLUT RIITTÚVÚSTI TIETOJA!");	   while( getch()!=32 );	   gotoxy(10,16);textbackground(5);	   cprintf("                                            ");	   return 0;} return 1;}/*********************************************************************/int pura_mj( char *mj, int &kirja, int &luku, int &jae )// Purkaa syätteen³ tulleen merkkijonon mj kirjaksi, luvuksi ja jakeeksi.// Palauttaa virhenumeron: -1 tarkoittaa, ett³ syätteess³ on muutakin kuin// numeroita, 1, 2 tai 3 tarkoittavat, ett³ syätteess³ on ollut liian v³h³n// lukuja. Virheetän syättä palauttaa 0:n.{  char varamj[12],*p;  strncpy(varamj,mj,11);  kirja=0;luku=0;jae=0;  p=strtok( varamj, " ");kirja=atoi(p);  if (!numeroita(p)) return -1;  if (!kirja) return 1;  p=strtok( NULL, " ");luku=atoi(p);  if (!numeroita(p)) return -1;  if (!luku) return 2;  p=strtok( NULL, " ");jae=atoi(p);  if (!numeroita(p)) return -1;  if (!jae) return 3;  return 0;}/*********************************************************************/// Jaejakson kysymiseen liittyvi³ tulostusapuohjelmiavoid poista_tulostettu_jaejakso(){  gotoxy(50,17); textcolor(0); textbackground(5);  cprintf("                             ");  gotoxy(50,18);  cprintf("                                   ");}void lyhyt_syotto_ohje(){  gotoxy(10,20);  textcolor(7); textbackground(5); // cprintf("          ");  cout << "Anna jaejakso ALKUKIRJA ALKULUKU ALKUJAE (ENTER).";  gotoxy(10,21);  cout << "Editoi oletusta LOPPUKIRJA LOPPULUKU LOPPUJAE (ENTER).";}void jaejakson_alun_valmistus(){  gotoxy(10,18);  cout << "Anna jaejakson alku  " ;  // syättäalue vaaleanharmaaksi  gotoxy(34,18); textcolor(0); textbackground(7); cprintf("           ");  gotoxy(34,18);}void jaejakson_loppuosan_valmistus(){  gotoxy(10,18);  cout << "Anna jaejakson loppu " ;  gotoxy(34,18); textcolor(0); textbackground(7);  cprintf("           ");  gotoxy(34,18);}void ala_valikko(){ gotoxy(1,25); textcolor(5); textbackground(8);// cprintf("          "); cprintf("  (L) Lopeta   (?) Opastus"); cprintf("   (V) Viite valmis     "); for(int i=47;i<=80;i++) { gotoxy(i,25);cprintf(" "); }}/********************************************************/// Loppukysely siit³, korjataanko syätetty jaejakso vai eichar hyvaksy_korjaa_kysely(int oikeellisuus){  char kysmerkki;  gotoxy(10,16);textcolor(14); textbackground(5);  if (oikeellisuus) {    cprintf("Hyv³ksy [H] / Korjaa [K]");    do { kysmerkki=toupper(getch()); }      while (( kysmerkki!='H') && (kysmerkki!='K'));  } else {    cprintf("Korjaa [K/E]"); // E=Ei korjata, ei myäsk³³n tallenneta    do { kysmerkki=toupper(getch()); }      while (( kysmerkki!='E') && (kysmerkki!='K'));  }  gotoxy(10,16);textbackground(5);cprintf("                        ");  return kysmerkki;}void apua( int tilanne, char kysmerkki,	   int alkukirja, int alkuluku, int alkujae ,	   int loppukirja, int loppuluku, int loppujae ){  clrscr();  alusta_help("HELP");  help(NULL);  vapauta_help();  tulosta_kirjat();  ala_valikko();  lyhyt_syotto_ohje();  if (kysmerkki=='K') {    tulosta_jaejakso(alkukirja, alkuluku, alkujae,      loppukirja, loppuluku, loppujae );  }  switch (tilanne) {    case 1 : jaejakson_alun_valmistus();break;    case 2 : jaejakson_loppuosan_valmistus();break;  }}/**************************************************************/// Varsinainen jaejakson kysyminenvoid kysy_jaejaksoja( cJaejaksot &jaejaksot ){ cJaejakso jaejakso; int alkukirja, alkuluku, alkujae, loppukirja, loppuluku, loppujae; int varaalkukirja,varaalkuluku,varaalkujae; int oikeellisuus; int virhenro; char rivi[11],rivi2[11]; char lopmerkki, kysmerkki; char lopetusmerkit[4]="\rL?"; kysmerkki='H'; do {   virhenro=0;   if (kysmerkki!='K') { strcpy(rivi,"");poista_tulostettu_jaejakso(); }   lyhyt_syotto_ohje();   jaejakson_alun_valmistus();   do {     lopmerkki=lue_jono(rivi,10,lopetusmerkit);     if (lopmerkki=='?')       apua( 1 , kysmerkki, varaalkukirja, varaalkuluku, varaalkujae ,		 loppukirja, loppuluku, loppujae );   } while (lopmerkki=='?');   if (lopmerkki=='L') break; // EI TALLETETA SYúTTúÚ !   if (kysmerkki!='K') strcpy(rivi2,rivi);   virhenro=pura_mj( rivi, alkukirja, alkuluku, alkujae );   if (virhenro==0) {     jaejakson_loppuosan_valmistus();     do {       lopmerkki=lue_jono(rivi2,10,lopetusmerkit);       if (lopmerkki=='?')	 apua( 2 , kysmerkki, varaalkukirja, varaalkuluku, varaalkujae ,		   loppukirja, loppuluku, loppujae );     } while (lopmerkki=='?');     virhenro=pura_mj( rivi2, loppukirja, loppuluku, loppujae );   }   oikeellisuus=jaejakso_oikeellisuus( alkukirja, alkuluku, alkujae,				       loppukirja, loppuluku, loppujae,				       virhenro );   // tulostetaan syätetty jaejakso   if (kysmerkki=='K') poista_tulostettu_jaejakso();   if (virhenro==0) {     gotoxy(50,17);     textcolor(0); textbackground(5);     cprintf("Antamasi jaejakso oli ");     gotoxy(50,18);     tulosta_jaejakso( alkukirja, alkuluku, alkujae,     loppukirja, loppuluku, loppujae );   }   // Hyv³ksymis / korjaamiskysely   kysmerkki=hyvaksy_korjaa_kysely( oikeellisuus );   // Rakenteeseen tallennus   if ((kysmerkki=='H') && oikeellisuus) {     // talletetaan kysytty jaejakso rakenteeseen     jaejakso.aseta_alkujae( alkukirja, alkuluku, alkujae );     jaejakso.aseta_loppujae( loppukirja, loppuluku, loppujae );     jaejaksot.lisaa_jaejakso( jaejakso );   };   if (kysmerkki=='K')     { varaalkukirja=alkukirja;varaalkuluku=alkuluku;varaalkujae=alkujae; } } while (lopmerkki!='L');}/***********************************************************************/void kysy_viite(){   lue_kirjat();   tulosta_kirjat();   ala_valikko();   gotoxy(10,23);   textcolor(7); textbackground(5);   cprintf("Anna viitteeseen tulevat jaejaksot ja sen j³lkeen V ");   // kysy_jaejakso();}void tulosta_jaejaksot( cJaejaksot &jaejaksot ){  int maara;  unsigned char alkukirja=0, alkuluku=0, alkujae=0, loppukirja=0, loppuluku=0,		loppujae=0;  cJaejakso jaejakso;  maara=jaejaksot.Lkm();  clrscr();  cout << "Jaejaksoja syntyi " << maara << " kappaletta." << endl;  for(int i=0;i<maara;i++)    {       jaejakso = jaejaksot.anna_jaejakso(i);       jaejakso.anna_alkujae(&alkukirja,&alkuluku,&alkujae);       jaejakso.anna_loppujae(&loppukirja,&loppuluku,&loppujae);       gotoxy(1,i+2);       tulosta_jaejakso( alkukirja, alkuluku, alkujae,	  loppukirja, loppuluku, loppujae );    }}int main(){  cJaejaksot jaejaksot;  lue_kirjat();  tulosta_kirjat();  ala_valikko();  kysy_jaejaksoja( jaejaksot );  tulosta_jaejaksot( jaejaksot );//  kysy_viite();  return 0;}