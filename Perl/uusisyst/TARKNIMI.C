#include<stdio.h>#include<stdlib.h>#include<string.h>struct tdnimi { char kn[80]; char tdn[15]; int lomakenro ;		struct tdnimi *seur; } x;struct sama_alkio { char tdn[15]; struct sama_alkio *seur; } y;int main(){  char juuri[80],tdnimi[80],nroteks[4],rivi[80];  FILE *tatdvuo,*samtd;  int tdnro,tdmaara,loppu,onjosama,ensimsama,olisamoja,oikeatd;  struct tdnimi *alku,*uusi,*edel,*kelaus,*kelaus2;  struct sama_alkio *samalku,*samkelaus,*samuusi,*samedel;  printf("Anna lomaketiedostojen juuri:\n");  scanf("%s",juuri);  printf("Anna tiedostojen lukum³³r³:\n");  scanf("%d",&tdmaara);  // Ker³t³³n kent³nnimi, tiedostonimi -parit listaan.  alku=NULL;olisamoja=0;  for(tdnro=1;tdnro<=tdmaara;tdnro++) {    strcpy(tdnimi,juuri);    itoa(tdnro,nroteks,10);    strcat(tdnimi,nroteks);strcat(tdnimi,".ta");    tatdvuo=fopen(tdnimi,"r");    loppu=0;    while( loppu==0 ) {       if (fgets(rivi,80,tatdvuo)==NULL) { loppu=1; }       if (strcmp(rivi,"\n")==0) { loppu=1; }       if (!loppu) {	 uusi=(struct tdnimi *)malloc(sizeof(struct tdnimi));	 rivi[strlen(rivi)-1]='\0';	 strcpy(uusi->kn,rivi);	 fgets(rivi,80,tatdvuo);	 rivi[strlen(rivi)-1]='\0';	 strcpy(uusi->tdn,rivi);	 uusi->lomakenro=tdnro;uusi->seur=NULL;	 if (alku==NULL) { alku=uusi;edel=uusi; } else	   { edel->seur=uusi;edel=uusi; }       }    }    fclose(tatdvuo);  }  // K³yd³³n jokainen kent³nnimi l³pi ja katsotaan, onko se  // kentt³, jolla on sama tiedostonimi jonkun muun kent³n  // kanssa. Jos on, lis³t³³n se listaan samalku.  // Jos kent³nnimi on jo listassa samalku, se sivuutetaan.  // Samat kent³t talletetaan tiedostoon samatd.txt  // Jos tiedostonimi on nimitie,tiedm tai se on tav-alkuinen  // Se kirjoitetaan myäs samatd.txt -tiedostoon.  samtd=fopen("samatd.txt","w");  kelaus=alku;samalku=NULL;  while( kelaus!=NULL ) {    // Tutkitaan, onko kelaus-tiedostonimi, joku kielletyist³    // tiedostonimist³    oikeatd=1;    if ( strcmp(samkelaus->tdn,"tiedm")==0 ) { oikeatd=0; }    if ( strcmp(samkelaus->tdn,"nimitie")==0 ) { oikeatd=0; }    if ( strncmp(samkelaus->tdn,"tav",3)==0 ) { oikeatd=0; }    if (oikeatd) {    // Tutkitaan, onko kelaus-tiedostonimi jo samojen listalla.      samkelaus=samalku;onjosama=0;      while( (samkelaus!=NULL) && (onjosama==0) ) {	if (strcmp(samkelaus->tdn,kelaus->tdn)==0) { onjosama=1; }	samkelaus=samkelaus->seur;      }    // Jos ei, tutkitaan, onko tiedostonimien listalla samoja tiedostonimi³    // jollakin muulla kent³ll³. Jos on, lis³t³³n t³m³ tiedostonimi listaan ja    // tulostetaan t³t³ tiedostonime³ vastaavat kent³nnimet    // tiedostoon samatd.txt.      if (!onjosama) { // if onjosama	kelaus2=alku;	ensimsama=1;	while( kelaus2!=NULL ) { // while kelaus2	  if (kelaus2!=kelaus) { // if kelaus2	    if (strcmp(kelaus2->tdn,kelaus->tdn)==0) { // if strcmp	      if (ensimsama) { // if ensimsama		samuusi = 		  (struct sama_alkio *)malloc(sizeof(struct sama_alkio ));		strcpy( samuusi->tdn , kelaus->tdn );		samuusi->seur=NULL;		if (samalku==NULL) { samalku=samuusi;samedel=samuusi; } else		  { samedel->seur=samuusi;samedel=samuusi; }		ensimsama=0;olisamoja=1;		fprintf( samtd ,"Kentill³ lomake %d:kent³nnimi %s, lomake %d:kent³nnimi %s",kelaus->lomakenro, kelaus->kn,kelaus2->lomakenro, kelaus2->kn );	      } else {		 fprintf( samtd , ", lomake %d:kent³nnimi %s",		       kelaus2->lomakenro, kelaus2->kn );	      } // if ensinsama	    } // if strcmp	  } // if kelaus2	  kelaus2=kelaus2->seur;	} // while kelaus2	if (!ensimsama) {	    fprintf( samtd , " on sama tiedostonimi %s.\n", kelaus->tdn );	}      } // if onjosama    } else {      fprintf( samtd , "Lomakkeella %d, kent³ll³ %s on tiedostonimen³ %s,",	       kelaus->lomakenro, kelaus->kn , kelaus->tdn );      fprintf( samtd , "mik³ ei kelpaa, koska j³rjestelm³ k³ytt³³ sit³.\n");      olisamoja=1;    }    // Seuraava tutkittava.    kelaus=kelaus->seur;  }  fclose(samtd);  // Vapautetaan kent³nnimi,tiedostonimi -parien lista  while(alku!=NULL) {    edel=alku;alku=alku->seur;free(edel);  }  // Vapautetaan samojen tiedostonimien lista.  while(samalku!=NULL) {    samedel=samalku;samalku=samalku->seur;free(samedel);  }  if (olisamoja) {    printf("Lomakkeilla oli samoja tai mahdollisesti ");    printf("j³rjestelm³n k³ytt³mi³ tiedostonimi³.");    printf("Ne on koottu tiedostoon samatd.txt.\n");  }  return 0;}